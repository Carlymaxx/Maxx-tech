const express = require("express");
const moment = require("moment-timezone");
const app = express();

const startTime = Date.now();

function getUptime() {
  const diff = Date.now() - startTime;
  const sec = Math.floor(diff / 1000);
  const min = Math.floor(sec / 60);
  const hr = Math.floor(min / 60);
  return `${hr}h ${min % 60}m ${sec % 60}s`;
}

function getNairobiTime() {
  return moment().tz("Africa/Nairobi").format("dddd, MMMM Do YYYY, h:mm:ss a");
}

const menu = `
üí† MAXX~XMD BOT MENU üí†
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üì° Ping          ‚Üí !ping
‚öô Uptime        ‚Üí !uptime
üïì Nairobi Time  ‚Üí !time
üèô Location      ‚Üí Ruiru
üëë Owner         ‚Üí CarlyMaxx
üí¨ Status        ‚Üí Bot Alive
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Type any of the commands above.
`;
app.post("/api/link", (req, res) => {
  const number = req.body.number;
  if (!number) return res.json({ error: "Invalid number!" });

  const code = Math.floor(100000 + Math.random() * 900000).toString();
  codes[number] = code;

  res.json({ code });
});

app.get("/api/message", (req, res) => {
  const msg = (req.query.text || "").toLowerCase().trim();
  let reply;

  switch (msg) {
    case "menu":
    case "!menu":
      reply = menu;
      break;
    case "ping":
    case "!ping":
      reply = `üèì Pong! Latency ${(Math.random() * 100).toFixed(1)}ms`;
      break;
    case "uptime":
    case "!uptime":
      reply = `‚è± Bot Uptime: ${getUptime()}`;
      break;
    case "time":
    case "!time":
      reply = `üïì Nairobi Time: ${getNairobiTime()}`;
      break;
    case "alive":
    case "!alive":
      reply = "ü§ñ Maxx~XMD Bot is Alive and Running!";
      break;
    default:
      reply = "‚ùì Unknown command.\nType !menu to see available commands.";
  }

  res.json({ reply });
});

app.get("/", (req, res) => {
  res.send(`
    <html>
      <head>
        <title>Maxx~XMD Bot</title>
        <style>
          body {
            font-family: 'Poppins', sans-serif;
            background: #0d0d0d;
            color: #00ffcc;
            text-align: center;
            padding-top: 100px;
          }
          a {
            color: #00ffff;
            text-decoration: none;
            border: 1px solid #00ffff;
            padding: 10px 20px;
            border-radius: 8px;
          }
          a:hover {
            background: #00ffff;
            color: #0d0d0d;
          }
        </style>
      </head>
      <body>
        <h1>ü§ñ Maxx~XMD Bot is Running</h1>
        <p>Owner: <strong>CarlyMaxx</strong></p>
        <a href="https://github.com/Carlymaxx/Maxx-tech.git" target="_blank">
          üåê Visit GitHub Repo
        </a>
      </body>
    </html>
  `);
});

const port = 3000;
const githubRepo = "https://github.com/Carlymaxx/Maxx-tech.git";

app.listen(port, () => {
  console.log(`‚úÖ Maxx~XMD Bot running ‚Äî Repo: ${githubRepo}`);
});